<?xml version="1.0" encoding="utf-8" ?>
<UipTask Name="MainTask" xmlns="http://www.quokka.org/schemas/2006/UipTask.xsd">
  <State Type="Mps.Local.Uip.MainTaskState"/>
  <StatePersist Type="Microsoft.ApplicationBlocks.UIProcess.MemoryStatePersistence"/>
  <ViewManager Type="Microsoft.ApplicationBlocks.UIProcess.WinFormViewManager"/>
  
  <NavigationGraph StartNode="CheckConfig">
    <Node Name="CheckConfig">
      <View Type="Mps.Local.Client.Win.InProgressForm"/>
      <Controller Type="Mps.Local.Client.Win.Uip.CheckConfigController"/>
      <NavigateTo NavigateValue="next" Node="MainMenu"/>
      <NavigateTo NavigateValue="config" Node="DatabaseLocation"/>
      <NavigateTo NavigateValue="upgradeDatabase" Node="BeforeUpgradeDatabase"/>
    </Node>

    <Node Name="DatabaseLocation">
      <View Type="Mps.Local.Client.Win.DatabaseLocation"/>
      <Controller Type="Mps.Local.Client.Win.Uip.DatabaseLocationController"/>
      <NavigateTo NavigateValue="next" Node="MainMenu"/>
      <NavigateTo NavigateValue="upgradeDatabase" Node="BeforeUpgradeDatabase"/>
    </Node>

    <Node Name="BeforeUpgradeDatabase">
      <View Type="Mps.Local.Client.Win.BeforeUpgradeDatabase"/>
      <Controller Type="Mps.Local.Client.Win.Uip.UpgradeDatabaseController"/>
      <NavigateTo NavigateValue="next" Node="DatabaseUpgrade"/>
    </Node>

    <Node Name="DatabaseUpgrade">
      <View Type="Mps.Local.Client.Win.InProgressForm"/>
      <Controller Type="Mps.Local.Client.Win.Uip.UpgradeDatabaseController"/>
      <NavigateTo NavigateValue="next" Node="MainMenu"/>
    </Node>

    <Node Name="MainMenu">
      <View Type="Mps.Local.Client.Win.MainForm2"/>
      <Controller Type="Mps.Local.Uip.MainTaskController"/>
      <NavigateTo NavigateValue="login" Node="Login"/>
      <NavigateTo NavigateValue="config" Node="DatabaseLocation"/>
    </Node>

    <Node Name="Login">
      <View Type="Mps.Local.Client.Win.LoginForm"/>
      <Controller Type="Mps.Local.Uip.LoginController"/>
      <NavigateTo NavigateValue="next" Node="LoginProgress"/>
      <NavigateTo NavigateValue="cancel" Node="MainMenu"/>
    </Node>

    <Node Name="LoginProgress">
      <View Type="Mps.Local.Client.Win.InProgressForm"/>
      <Controller Type="Mps.Local.Uip.LoginController"/>
      <NavigateTo NavigateValue="next" Node="MainMenu"/>
      <NavigateTo NavigateValue="error" Node="Login"/>
    </Node>
  </NavigationGraph>
</UipTask>
